$(function(){Parse.initialize("lwRB5rPvenfJwKYSeDtnCsXj4WNZa3PuwAyAIN3P","D7k2Ttgt6bzQhGhV3BWRAz42EKSKjZvBaevdl7fU");var g=Parse.Object.extend("Gif");Parse.Collection.extend({model:g});GifBoardView=Parse.View.extend({el:$(".content"),template:_.template($("#gif-board-template").html()),initialize:function(){_.bindAll(this);$(".content").empty();$(".error").empty();this.render(this.options.gifs);$(".loading").hide()},render:function(a){var b=this;a.length>0?(a.forEach(function(a){if(b.options.source===
"parse"){var c={src:a.attributes.src};$(b.el).prepend(b.template(c))}else b.options.source==="reddit"&&(c={src:a.data.url},a.data.url.indexOf(".gif")>=0&&$(b.el).append(b.template(c)))}),$("a.gif").size()<1&&new ErrorView({title:b.options.errorTitle,message:b.options.errorMessage})):(alert($("a.gif").size()),new ErrorView({title:b.options.errorTitle,message:b.options.errorMessage}))}});GifFullView=Parse.View.extend({el:$(".content"),template:_.template($("#gallery-gif-template").html()),initialize:function(){_.bindAll(this,
"sizer");$(".content").empty();$(".error").empty();this.render(this.options.gifs);$(".loading").hide()},render:function(a){var b=this;a.length>0?(a.forEach(function(a){if(b.options.source==="parse"){var c={src:a.attributes.src,id:a.id,tags:a.attributes.tags};$(b.el).prepend(b.template(c))}else b.options.source==="reddit"&&(c={src:a.data.url,id:"reddit",tags:[""]},a.data.url.indexOf(".gif")>=0&&$(b.el).append(b.template(c)))}),$("a.gif").size()<1&&new ErrorView({title:b.options.errorTitle,message:b.options.errorMessage}),
new PlayGallery,b.sizer()):new ErrorView({title:b.options.errorTitle,message:b.options.errorMessage})},sizer:function(){var a=window.innerWidth,b=window.innerHeight;$(".content .gif-container img.the-gif").css({width:a,height:b});$(window).resize(function(){var a=window.innerWidth,b=window.innerHeight;$(".content .gif-container img.the-gif").css({width:a,height:b})})}});AllGifsView=Parse.View.extend({el:$(".title"),template:_.template($("#title-board-template").html()),initialize:function(){_.bindAll(this);
$(".loading").show();var a=Parse.Object.extend("Gif"),a=new Parse.Query(a);a.limit(1E3);a.ascending("createdAt");a.find({success:function(a){new GifFullView({source:"parse",gifs:a,errorTitle:"Rats",errorMessage:"We couldn't find any gifs, bro."})},error:function(){new ErrorView({title:"Error 420",message:"You're not high enough."})}});this.render()},render:function(){$(".title").empty();$(this.el).prepend(this.template({title:"all"}))}});RedditGifsView=Parse.View.extend({el:$(".title"),template:_.template($("#title-board-template").html()),
initialize:function(){_.bindAll(this);$(".loading").show();var a=this;this.title="r/"+this.options.subreddit+"";$.getJSON("http://www.reddit.com/"+this.title+".json?sort=hot&limit=100&jsonp=?",{format:"jsonp"},function(b){new GifFullView({source:"reddit",gifs:b.data.children,errorTitle:"Nope",errorMessage:"No popular gifs in <em>"+a.title+"</em> at the moment."})}).error(function(){new ErrorView({title:"Bummer.",message:"Doesn't look like <em>"+a.title+"</em> exists."})});this.render()},render:function(){$(".title").empty();
var a={title:this.title};$(this.el).prepend(this.template(a))}});UserGifsView=Parse.View.extend({el:$(".title"),template:_.template($("#title-board-template").html()),initialize:function(){_.bindAll(this);$(".loading").show();var a=this,b=this.options.username,d=new Parse.Query("Gif");d.matches("username",b);d.ascending("createdAt");d.find({success:function(c){a.options.viewtype==="grid"?new GifBoardView({source:"parse",gifs:c,errorTitle:"Damn",errorMessage:"We couldn't find any gifs from <em>"+b+
"</em>. Try again."}):new GifFullView({source:"parse",gifs:c,errorTitle:"Damn",errorMessage:"We couldn't find any gifs from <em>"+b+"</em>. Try again."})},error:function(){new ErrorView({title:"Fuck.",message:"Something bad happened. Try again."})}});this.render()},render:function(){$(".title").empty();var a={title:"u/"+this.options.username+""};$(this.el).prepend(this.template(a))}});TagGifsView=Parse.View.extend({el:$(".title"),template:_.template($("#title-board-template").html()),initialize:function(){_.bindAll(this);
$(".loading").show();var a=this.options.tag,b=new Parse.Query("Gif");b.equalTo("tags",a);b.find({success:function(b){new GifFullView({source:"parse",gifs:b,errorTitle:"Nada",errorMessage:"No gifs tagged <em>"+a+"</em>, bro. You should add some."})},error:function(){new ErrorView({title:"Fuck",message:"Crazy error, bro. Try again."})}});this.render()},render:function(){$(".title").empty();var a={title:"tag/"+this.options.tag+""};$(this.el).prepend(this.template(a))}});PlayGallery=Parse.View.extend({el:$(".content"),
initialize:function(){_.bindAll(this);this.element=$(".content");var a=this.element.find(".gif-container");a.slice(0,5).each(function(){$(this).removeClass("unloaded").addClass("loaded");var a=$(this).find("img.the-gif"),d=a.attr("data-src");a.attr("src",d)});a.eq(0).removeClass("hide")}});SingleGifView=Parse.View.extend({el:$(".content"),template:_.template($("#single-gif-template").html()),events:{"click a.gif-one":"allGifs"},initialize:function(){_.bindAll(this,"sizer","allGifs");var a=this,b=
Parse.Object.extend("Gif");this.gif=new Parse.Query(b);this.gif.get(this.options.gif,{success:function(b){a.render(b)},error:function(){new ErrorView({title:"Sorry",message:"We couldn't find that gif, bro."})}})},render:function(a){a={src:a.attributes.src,id:a.id,tags:a.attributes.tags};$(this.el).html(this.template(a));this.sizer()},sizer:function(){var a=window.innerWidth,b=window.innerHeight;$(".content .gif-container img.the-gif").css({width:a,height:b});$(window).resize(function(){var a=window.innerWidth,
b=window.innerHeight;$(".content .gif-container img.the-gif").css({width:a,height:b})})},allGifs:function(){h.navigate("all",{trigger:!0})}});SearchView=Parse.View.extend({el:$(".search"),template:_.template($("#search-template").html()),events:{"submit form.search":"search","focus form.search input":"focus"},initialize:function(){_.bindAll(this,"search","focus");this.render()},render:function(){$(this.el).html(this.template())},search:function(){var a=$("form.search input").val().toLowerCase().replace(/ /g,
"-");a&&h.navigate("tag/"+a+"",{trigger:!0});return!1},focus:function(){$("form.search input").attr("placeholder","");$("form.search input").blur(function(){$("form.search input").attr("placeholder","search the gifs")})}});NonuserView=Parse.View.extend({el:".user",template:_.template($("#nonuser-template").html()),events:{"submit form.login-form":"logIn","submit form.signup-form":"signUp"},initialize:function(){_.bindAll(this,"logIn","signUp");$("#signup-modal").modal();$("#login-modal").modal();
this.render()},render:function(){this.$el.html(this.template())},logIn:function(){var a=this,b=this.$("#login-username").val(),d=this.$("#login-password").val();Parse.User.logIn(b,d,{success:function(b){a.username=b.attributes.username;new UserView({username:a.username});new UploadView;$(".modal").modal("hide");_gaq.push(["_trackEvent","Login","login",""])},error:function(){a.$(".login-form .error").html("Invalid username or password. Please try again.").show();a.$(".login-form button").removeAttr("disabled")}});
this.$(".login-form button").attr("disabled","disabled");return!1},signUp:function(){return!1}});UserView=Parse.View.extend({el:$(".user"),template:_.template($("#user-template").html()),events:{"click .log-out":"logOut"},initialize:function(){_.bindAll(this,"logOut");var a=this,b=Parse.User.current().id,d=Parse.Object.extend("User");(new Parse.Query(d)).get(b,{success:function(b){a.render(b.attributes.username,b.attributes.avatar?b.attributes.avatar.url:"img/avatar-default.png")},error:function(){a.render(username,
avatar)}})},render:function(a,b){$(this.el).html(this.template({username:a,avatar:b}));new UploadView},logOut:function(){Parse.User.logOut();_gaq.push(["_trackEvent","Logout","logout",""]);new NonuserView}});UploadView=Parse.View.extend({events:{"change #fileselect":"grabFile","submit #fileupload":"uploadGif","submit #urladd":"addUrl"},el:".loggedin .add",template:_.template($("#upload-template").html()),appid:"lwRB5rPvenfJwKYSeDtnCsXj4WNZa3PuwAyAIN3P",restkey:"LfkvpLyFErkF84FPPoZIOzOvSNH10jQI1meGnLEr",
initialize:function(){_.bindAll(this,"uploadGif","grabFile","addGif","addUrl","addToUser");this.render()},render:function(){this.$el.append(this.template);$("form input.tags").each(function(){$(this).tagsManager({maxTags:3})});$("a.add-toggle").click(function(){$("form.add").toggle();$("form#urladd:visible")&&$("form#urladd .urladdsrc").focus().val("")})},grabFile:function(a){this.file=(a.target.files||a.dataTransfer.files)[0];this.filetype=this.file.type},uploadGif:function(){if(this.filetype===
"image/gif"){$("button.add-gif:visible").button("loading");var a=this;$.ajax({type:"POST",beforeSend:function(b){b.setRequestHeader("X-Parse-Application-Id",a.appid);b.setRequestHeader("X-Parse-REST-API-Key",a.restkey);b.setRequestHeader("Content-Type",a.file.type)},url:"https://api.parse.com/1/files/"+this.file.name,data:a.file,processData:!1,contentType:!1,success:function(b){a.addGif(b.url)},error:function(){new ErrorView({title:"Awww, Bro",message:"We encountered an error. Try again."})}})}else $("#fileupload .error").html("The name of this site is <em>gifasm</em>. You need to upload a gif.").show();
return!1},addGif:function(a){var b=this;if(a.substr(-5).indexOf(".gif")>=0){var b=this,d=Parse.User.current().id,c=$(".username").text(),e=$("form:visible input[name=hidden-tags]").val().toLowerCase(),f=new g;f.set("src",a);f.set("username",c);f.set("userid",d);e&&(e=e.split(","),f.set("tags",e));f.save(null,{success:function(a){Parse.User.current()&&b.addToUser(a);$(".modal").modal("hide");$("span.myTag").remove();$("input.urladdsrc").val("");_gaq.push(["_trackEvent","Added Gif","added gif",""]);
h.navigate("#/gif/"+a.id+"",{trigger:!0})},error:function(){new ErrorView({title:"Shit, Error.",message:"We couldn't save that gif for you. Try again."})}})}else $("#urladd .error").html("That doesn't appear to be a gif. Try again, homey.").show()},addUrl:function(){this.addGif(this.$("input.urladdsrc").val());return!1},addToUser:function(a){var b=Parse.User.current();b.relation("gifs").add(a);b.save(null,{success:function(){},error:function(){}})}});ErrorView=Parse.View.extend({el:$(".error"),template:_.template($("#error-template").html()),
initialize:function(){_.bindAll(this);this.render();$(".loading").hide();$(".content").empty()},render:function(){var a={title:this.options.title,message:this.options.message};$(this.el).html(this.template(a));$(".error").show();_gaq.push(["_trackPageview","error"]);_gaq.push(["_trackEvent","Error","error",""])}});AppView=Parse.View.extend({el:".content",events:{"click div.gallery-gif":"nextgif","click .tags span":"tag","click a.regif":"regif"},initialize:function(){_.bindAll(this,"nextgif","tag",
"regif");this.render()},render:function(){Parse.User.current()?new UserView:new NonuserView;new SearchView},nextgif:function(){var a=$("div.gallery-gif:visible"),b=a.index()+1,b=$(".content").find(".gif-container:eq("+b+")");a.addClass("hide");b.length?(b.removeClass("hide"),b.attr("id"),a=$(".content .gif-container.unloaded").eq(0),a.length&&(a.removeClass("unloaded").addClass("loaded"),a=a.find("img.the-gif"),b=a.attr("data-src"),a.attr("src",b))):$(".content .gallery-gif").eq(0).removeClass("hide");
_gaq.push(["_trackPageview",window.location.hash])},tag:function(a){event.stopPropogation(a)},regif:function(){var a=Parse.User.current(),b=$(".gallery-gif:visible").find("img").attr("src");a?reGif(b):$("#signup-modal").modal("show");event.stopPropogation()}});var h=new (Parse.Router.extend({routes:{"":"home",all:"all","gif/:id":"singleGif","u/:username/:viewtype":"userGalleryView","u/:username":"userGallery","tag/:tag":"tagGallery",about:"about","r/:subreddit":"reddit",":whatever":"404"},initialize:function(){new AppView},
home:function(){new AllGifsView},all:function(){new AllGifsView},singleGif:function(a){new SingleGifView({gif:a})},userGalleryView:function(a,b){new UserGifsView({username:a,viewtype:b})},userGallery:function(a){new UserGifsView({username:a})},tagGallery:function(a){a=a.replace(/-/g," ");a=a.toLowerCase();new TagGifsView({tag:a})},reddit:function(a){new RedditGifsView({subreddit:a})},404:function(){new ErrorView({title:"Well, Fuck",message:"We couldn't find that page."})}}));Parse.history.start();
signUp=function(){var a=$(this),b=$("form#signup #signup-username").val(),d=$("form#signup #signup-password").val(),c=new Parse.User;c.set("username",b);c.set("password",d);c.signUp(null,{success:function(a){new UserView({username:a.attributes.username});new UploadView;$(".modal").modal("hide");_gaq.push(["_trackEvent","Signup","signup",""])},error:function(a,b){$("form#signup .error").html(b.message).show();$("form#signup button").removeAttr("disabled")}});a.find(".signup-form button").attr("disabled",
"disabled");return!1};$(".login").click(function(){$("#signup-modal").modal("hide");$("#login-modal").modal("show");$("#login-username").focus()});$(".signup").click(function(){$("#login-modal").modal("hide");$("#signup-modal").modal("show");$("#signup-username").focus()});$("a#add-modal-button").live("click",function(){$("#add-modal").modal("toggle")});reGif=function(a){var b=Parse.Object.extend("Gif"),b=new Parse.Query(b);b.equalTo("src",a);b.find({success:function(b){b.length||($("form#tagadd input.tags").tagsManager({maxTags:3}),
$("#tag-modal").modal("show"),$("form#tagadd").submit(function(){addExternalGif(a);$("#tag-modal").modal("hide");return!1}))},error:function(){new ErrorView({title:"Uh, oh.",errorMessage:"Something weird happened. Try again"})}})};addExternalGif=function(a){var b=Parse.User.current().id,d=$(".username").text(),c=new g,e=$("form#tagadd input[name=hidden-tags]").val().toLowerCase();c.set("src",a);c.set("username",d);c.set("userid",b);e&&(e=e.split(","),c.set("tags",e));c.save(null,{success:function(){alert(e);
_gaq.push(["_trackEvent","Regif","regif",""])},error:function(){alert("Regif error. Please try again")}})}});
